<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Dashboard</title>
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#9ca3af;
      --text:#e5e7eb;
      --accent:#60a5fa;
      --accent-2:#34d399;
      --border:#1f2937;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(80vw 80vh at 70% -10%, #0b1220, #0a0f1a) fixed, linear-gradient(180deg,#0b1220,#0b1220);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:100%;
      max-width:980px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.3px;
      color:#f3f4f6;
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .search{
      display:flex;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      overflow:hidden;
    }
    .search input{
      width:260px;
      padding:12px 14px;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
    }
    .search button{
      border:0;
      background:linear-gradient(135deg, var(--accent), #3b82f6);
      color:white;
      padding:0 14px;
      font-weight:600;
      cursor:pointer;
    }
    .units{
      display:flex;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:999px;
      padding:4px;
      gap:4px;
    }
    .units button{
      border:0;
      background:transparent;
      color:var(--muted);
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      min-width:48px;
    }
    .units button.active{
      background:linear-gradient(135deg, var(--accent-2), #22c55e20);
      color:#a7f3d0;
      border:1px solid #065f46;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    .card{
      background:linear-gradient(180deg, #0d1424, #0b1322);
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .location{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      color:#cbd5e1;
      font-size:14px;
      margin-bottom:8px;
    }
    .current-wrap{
      display:flex;
      align-items:center;
      gap:18px;
      margin-top:4px;
    }
    .temp{
      font-size:56px;
      font-weight:800;
      letter-spacing:-1px;
    }
    .temp small{
      font-size:.45em;
      color:var(--muted);
      font-weight:700;
      margin-left:2px;
    }
    .icon{
      font-size:36px;
      line-height:1;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.35));
    }
    .meta{
      color:#cbd5e1;
      font-size:14px;
    }
    .meta strong{color:#e5e7eb}

    h2{
      margin:0 0 10px 0;
      font-size:16px;
      color:#d1d5db;
      letter-spacing:.2px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    thead th{
      text-align:left;
      color:#9ca3af;
      font-weight:600;
      border-bottom:1px solid var(--border);
      padding:8px 6px;
    }
    tbody td{
      padding:10px 6px;
      border-bottom:1px solid var(--border);
      vertical-align:middle;
    }
    .row{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .cond{
      color:#cbd5e1;
    }
    .muted{color:var(--muted)}
    .status{
      min-height:20px;
      margin-top:8px;
      font-size:13px;
      color:#a5b4fc;
    }
    @media (max-width:800px){
      .grid{grid-template-columns:1fr}
      .search input{width:180px}
      .temp{font-size:48px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Weather Dashboard</h1>
      <div class="controls">
        <div class="search">
          <input id="search-input" type="text" placeholder="Search city (e.g., Paris)" aria-label="Search city" />
          <button id="search-btn" aria-label="Search">Search</button>
        </div>
        <div class="units" role="group" aria-label="Temperature unit">
          <button id="unit-c" class="active" aria-pressed="true">°C</button>
          <button id="unit-f" aria-pressed="false">°F</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="location">
          <div id="loc-name">—</div>
          <div class="muted" id="loc-time">—</div>
        </div>
        <div class="current-wrap">
          <div class="icon" id="current-icon" aria-hidden="true">⛅</div>
          <div>
            <div class="temp" id="current-temp">--<small>°C</small></div>
            <div class="meta">
              <span id="current-desc">—</span>
              <span class="muted"> • </span>
              <span>Wind: <strong id="current-wind">—</strong></span>
            </div>
          </div>
        </div>
        <div class="status" id="status"></div>
      </section>

      <section class="card">
        <h2>3-Day Forecast</h2>
        <table aria-label="3-Day Forecast">
          <thead>
            <tr>
              <th>Date</th>
              <th>Conditions</th>
              <th style="text-align:right">Min</th>
              <th style="text-align:right">Max</th>
            </tr>
          </thead>
          <tbody id="forecast-body">
            <!-- rows injected -->
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <script>
    const state = {
      unit: 'C', // 'C' or 'F'
      location: null, // {name, lat, lon}
      dataMetric: null // raw data in metric (Celsius)
    };

    const el = (id)=>document.getElementById(id);
    const statusEl = el('status');

    const WMO = {
      0: ["Clear sky", ["☀️","🌙"]],
      1: ["Mainly clear", ["🌤️","🌤️"]],
      2: ["Partly cloudy", ["⛅","⛅"]],
      3: ["Overcast", ["☁️","☁️"]],
      45: ["Fog", ["🌫️","🌫️"]],
      48: ["Depositing rime fog", ["🌫️","🌫️"]],
      51: ["Light drizzle", ["🌦️","🌦️"]],
      53: ["Moderate drizzle", ["🌦️","🌦️"]],
      55: ["Dense drizzle", ["🌧️","🌧️"]],
      56: ["Light freezing drizzle", ["🌧️","🌧️"]],
      57: ["Dense freezing drizzle", ["🌧️","🌧️"]],
      61: ["Slight rain", ["🌦️","🌦️"]],
      63: ["Moderate rain", ["🌧️","🌧️"]],
      65: ["Heavy rain", ["🌧️","🌧️"]],
      66: ["Light freezing rain", ["🌧️","🌧️"]],
      67: ["Heavy freezing rain", ["🌧️","🌧️"]],
      71: ["Slight snowfall", ["🌨️","🌨️"]],
      73: ["Moderate snowfall", ["❄️","❄️"]],
      75: ["Heavy snowfall", ["❄️","❄️"]],
      77: ["Snow grains", ["❄️","❄️"]],
      80: ["Rain showers", ["🌦️","🌧️"]],
      81: ["Heavy rain showers", ["🌧️","🌧️"]],
      82: ["Violent rain showers", ["🌧️","🌧️"]],
      85: ["Snow showers", ["🌨️","🌨️"]],
      86: ["Heavy snow showers", ["🌨️","🌨️"]],
      95: ["Thunderstorm", ["⛈️","⛈️"]],
      96: ["Thunderstorm with hail", ["⛈️","⛈️"]],
      99: ["Thunderstorm with heavy hail", ["⛈️","⛈️"]]
    };
    function codeToDesc(code){ return (WMO[code]?.[0]) || "N/A"; }
    function codeToIcon(code, isDay=1){
      const pair = WMO[code]?.[1];
      return pair ? pair[isDay?0:1] : "⛅";
    }
    const toF = c => c * 9/5 + 32;
    const fmtTemp = (c) => {
      if (c == null || isNaN(c)) return "--";
      const val = state.unit === 'C' ? c : toF(c);
      return Math.round(val);
    };
    function formatDate(dStr, tz){
      try{
        const d = new Date(dStr + (dStr.length<=10 ? 'T00:00:00' : ''));
        return d.toLocaleDateString(undefined, { weekday:'short', month:'short', day:'numeric', timeZone: tz || undefined });
      }catch(e){return dStr}
    }
    function setStatus(msg, good=false){
      statusEl.textContent = msg || '';
      statusEl.style.color = good ? '#86efac' : '#a5b4fc';
    }

    async function geocodeByName(name){
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Geocoding failed');
      const data = await res.json();
      if(!data.results || !data.results.length) throw new Error('No matching location');
      const r = data.results[0];
      return {
        name: [r.name, r.admin1, r.country_code].filter(Boolean).join(', '),
        lat: r.latitude,
        lon: r.longitude,
        tz: r.timezone
      };
    }

    async function fetchWeather(lat, lon, tz){
      const url = new URL('https://api.open-meteo.com/v1/forecast');
      url.searchParams.set('latitude', lat);
      url.searchParams.set('longitude', lon);
      url.searchParams.set('current_weather', 'true');
      url.searchParams.set('daily', 'weathercode,temperature_2m_max,temperature_2m_min');
      url.searchParams.set('forecast_days', '4'); // today + next 3 (we will show 3 rows)
      url.searchParams.set('timezone', tz || 'auto');
      const res = await fetch(url.toString());
      if(!res.ok) throw new Error('Weather fetch failed');
      return res.json();
    }

    function updateUI(){
      const loc = state.location;
      const d = state.dataMetric;
      if(!loc || !d) return;

      el('loc-name').textContent = loc.name;
      el('loc-time').textContent = new Date(d.current_weather.time).toLocaleString(undefined, { timeZone: d.timezone, hour:'2-digit', minute:'2-digit' });

      const currentC = d.current_weather.temperature;
      const icon = codeToIcon(d.current_weather.weathercode, d.current_weather.is_day);
      el('current-icon').textContent = icon;
      el('current-temp').innerHTML = `${fmtTemp(currentC)}<small>°${state.unit}</small>`;
      el('current-desc').textContent = codeToDesc(d.current_weather.weathercode);
      el('current-wind').textContent = `${Math.round(d.current_weather.windspeed)} km/h`;

      // Forecast: show 3 rows (today + next 2)
      const body = el('forecast-body');
      body.innerHTML = '';
      const tz = d.timezone;
      for(let i=0;i<3;i++){
        const date = d.daily.time[i];
        const code = d.daily.weathercode[i];
        const tminC = d.daily.temperature_2m_min[i];
        const tmaxC = d.daily.temperature_2m_max[i];
        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = formatDate(date, tz);
        const tdCond = document.createElement('td');
        const row = document.createElement('div');
        row.className = 'row';
        const spanIcon = document.createElement('span');
        spanIcon.className = 'icon';
        spanIcon.textContent = codeToIcon(code, 1);
        const spanCond = document.createElement('span');
        spanCond.className = 'cond';
        spanCond.textContent = codeToDesc(code);
        row.appendChild(spanIcon);
        row.appendChild(spanCond);
        tdCond.appendChild(row);

        const tdMin = document.createElement('td');
        tdMin.style.textAlign = 'right';
        tdMin.textContent = `${fmtTemp(tminC)}°${state.unit}`;

        const tdMax = document.createElement('td');
        tdMax.style.textAlign = 'right';
        tdMax.textContent = `${fmtTemp(tmaxC)}°${state.unit}`;

        tr.appendChild(tdDate);
        tr.appendChild(tdCond);
        tr.appendChild(tdMin);
        tr.appendChild(tdMax);
        body.appendChild(tr);
      }

      // Unit toggle active state
      document.querySelectorAll('.units button').forEach(b=>b.classList.remove('active'));
      const activeBtn = state.unit === 'C' ? el('unit-c') : el('unit-f');
      activeBtn.classList.add('active');
      el('unit-c').setAttribute('aria-pressed', state.unit==='C' ? 'true':'false');
      el('unit-f').setAttribute('aria-pressed', state.unit==='F' ? 'true':'false');
    }

    async function loadByLocation(loc){
      try{
        setStatus('Loading weather...');
        state.location = loc;
        const data = await fetchWeather(loc.lat, loc.lon, loc.tz);
        state.dataMetric = data; // Store metric
        setStatus('Updated', true);
        updateUI();
        setTimeout(()=>setStatus(''), 1200);
      }catch(err){
        console.error(err);
        setStatus(err.message || 'Failed to load weather');
      }
    }

    async function init(){
      // Bind UI
      el('search-btn').addEventListener('click', onSearch);
      el('search-input').addEventListener('keydown', (e)=>{ if(e.key==='Enter') onSearch(); });
      el('unit-c').addEventListener('click', ()=>{ if(state.unit!=='C'){ state.unit='C'; updateUI(); } });
      el('unit-f').addEventListener('click', ()=>{ if(state.unit!=='F'){ state.unit='F'; updateUI(); } });

      // Try geolocation first
      if('geolocation' in navigator){
        navigator.geolocation.getCurrentPosition(async (pos)=>{
          const {latitude:lat, longitude:lon} = pos.coords;
          try{
            // Reverse geocode to get a readable name
            const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en&format=json`;
            const res = await fetch(url);
            let name = 'Your location';
            let tz = 'auto';
            if(res.ok){
              const data = await res.json();
              const r = data && data.results && data.results[0];
              if(r){
                name = [r.name, r.admin1, r.country_code].filter(Boolean).join(', ');
                tz = r.timezone || 'auto';
              }
            }
            await loadByLocation({name, lat, lon, tz});
          }catch(e){
            await fallbackDefault();
          }
        }, async ()=>{
          await fallbackDefault();
        }, {enableHighAccuracy:true, timeout:5000});
      }else{
        await fallbackDefault();
      }
    }

    async function fallbackDefault(){
      try{
        const loc = await geocodeByName('New York');
        await loadByLocation(loc);
      }catch(e){
        setStatus('Unable to initialize. Please search for a city.');
      }
    }

    async function onSearch(){
      const q = el('search-input').value.trim();
      if(!q) return;
      try{
        setStatus('Searching...');
        const loc = await geocodeByName(q);
        await loadByLocation(loc);
      }catch(err){
        setStatus(err.message || 'Search failed');
      }
    }

    // Start
    init();
  </script>
</body>
</html>